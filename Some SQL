select * from TIME_GAP  where  WF_INSTANCE like '%WF%'

select * from TIME_GAP_ZONES  where  WF_INSTANCE like '%WF%'
 

edit TIME_GAP  where  WF_INSTANCE like 'WF%'

SELECT wf_name, event_description, retries FROM (    SELECT WF_NAME          , MIN(TRANSFER_TIMESTAMP) STARTED         , MAX(TRANSFER_TIMESTAMP) ENDED         , TARGET_HOST         , KAFKA_TOPIC         , SUM(EVENT_COUNT) EVENT_COUNT         , EVENT_DESCRIPTION         , NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0') RETRIES    FROM EVENT_DIST_AUDIT        WHERE TRANSFER_TIMESTAMP >= sysdate -(2/24)    AND WF_NAME in (select wf_name from EVENT_DIST_AUDIT eda where EDA.TRANSFER_TIMESTAMP >= sysdate -(2/24) and EDA.EVENT_DESCRIPTION = 'ERRONEOUS' )    GROUP BY WF_NAME           , NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0')           , TARGET_HOST           , KAFKA_TOPIC           , EVENT_DESCRIPTION    ORDER BY WF_NAME, STARTED, ENDED, RETRIES, TARGET_HOST, KAFKA_TOPIC, EVENT_DESCRIPTION)WHERE RETRIES >= 3 and event_description='ERRONEOUS'

SELECT WF_NAME, FILENAME_OUT, RECORDS_DIST, RECORDS_OUTBOUND FROM   (         SELECT WF_NAME, FILENAME_OUT, SUM(CDR_COUNT) AS RECORDS_DIST,                (                 SELECT SUM(EVENT_COUNT)                 FROM ( SELECT WF_NAME,                               FILENAME,                               EVENT_COUNT                        FROM   EVENT_DIST_AUDIT                        WHERE      WF_NAME LIKE 'CCMS%'                               AND EVENT_DESCRIPTION = 'OUTBOUND'                               AND TRANSFER_TIMESTAMP >= SYSDATE - INTERVAL '90' MINUTE                               AND TRANSFER_TIMESTAMP <= SYSDATE                               AND NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0') = 0 ) B WHERE  B.FILENAME = A.FILENAME_OUT GROUP BY WF_NAME, FILENAME ) RECORDS_OUTBOUND         FROM  PROC_OUT_AUDIT A         WHERE     WF_NAME IN ( 'CONCENTRATED', 'DEACTIVATION', 'DEL_DEACTIVATION', 'RATE_PLAN_CHANGE', 'SMART_CAMP_REPORTS',                                'SMART_CAMP_REWARDS', 'DATA_SUBSCRIPTION', 'DATA_TRAFFIC', 'OCS_CCN', 'POP_SMS_VOICE'   )  AND TIMESTAMP >= SYSDATE - INTERVAL '90' MINUTE AND TIMESTAMP <= SYSDATE - INTERVAL '30' MINUTE         GROUP BY WF_NAME, FILENAME_OUT        ) WHERE  RECORDS_DIST != NVL(RECORDS_OUTBOUND,0)

SELECT wf_name, event_description, retries FROM (    SELECT WF_NAME          , MIN(TRANSFER_TIMESTAMP) STARTED         , MAX(TRANSFER_TIMESTAMP) ENDED         , TARGET_HOST         , KAFKA_TOPIC         , SUM(EVENT_COUNT) EVENT_COUNT         , EVENT_DESCRIPTION         , NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0') RETRIES    FROM COS_OPER_OWNER.EVENT_DIST_AUDIT        WHERE TRANSFER_TIMESTAMP >= sysdate -(2/24)    AND WF_NAME in (select wf_name from COS_OPER_OWNER.EVENT_DIST_AUDIT eda where EDA.TRANSFER_TIMESTAMP >= sysdate -(2/24) and EDA.EVENT_DESCRIPTION = 'ERRONEOUS' )    GROUP BY WF_NAME           , NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0')           , TARGET_HOST           , KAFKA_TOPIC           , EVENT_DESCRIPTION    ORDER BY WF_NAME, STARTED, ENDED, RETRIES, TARGET_HOST, KAFKA_TOPIC, EVENT_DESCRIPTION)WHERE RETRIES >= 3 and event_description='ERRONEOUS'

SELECT wf_name, event_description, retries FROM (    SELECT WF_NAME          , MIN(TRANSFER_TIMESTAMP) STARTED         , MAX(TRANSFER_TIMESTAMP) ENDED         , TARGET_HOST         , KAFKA_TOPIC         , SUM(EVENT_COUNT) EVENT_COUNT         , EVENT_DESCRIPTION         , NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0') RETRIES    FROM COS_OPER_OWNER.EVENT_DIST_AUDIT        WHERE TRANSFER_TIMESTAMP >= sysdate -(2/24)    AND WF_NAME in (select wf_name from COS_OPER_OWNER.EVENT_DIST_AUDIT eda where EDA.TRANSFER_TIMESTAMP >= sysdate -(2/24) and EDA.EVENT_DESCRIPTION = 'ERRONEOUS' )    GROUP BY WF_NAME           , NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0')           , TARGET_HOST           , KAFKA_TOPIC           , EVENT_DESCRIPTION    ORDER BY WF_NAME, STARTED, ENDED, RETRIES, TARGET_HOST, KAFKA_TOPIC, EVENT_DESCRIPTION)WHERE RETRIES >= 3 and event_description='ERRONEOUS'

SELECT wf_name, event_description, retries   FROM (  SELECT WF_NAME,                  MIN (TRANSFER_TIMESTAMP) STARTED,                  MAX (TRANSFER_TIMESTAMP) ENDED,                  TARGET_HOST,                  KAFKA_TOPIC,                  SUM (EVENT_COUNT) EVENT_COUNT,                  EVENT_DESCRIPTION,                  NVL (                     SUBSTR (                        FILENAME,                        DECODE (INSTR (FILENAME, '/') + 1,                                1, 99999,                                INSTR (FILENAME, '/') + 1),                        LENGTH (FILENAME)),                     '0')                     RETRIES             FROM COS_OPER_OWNER.EVENT_DIST_AUDIT            WHERE     TRANSFER_TIMESTAMP >= SYSDATE - (2 / 24)                  AND WF_NAME IN                         (SELECT wf_name                            FROM COS_OPER_OWNER.EVENT_DIST_AUDIT eda                           WHERE     EDA.TRANSFER_TIMESTAMP >=                                        SYSDATE - (2 / 24)                                 AND EDA.EVENT_DESCRIPTION = 'ERRONEOUS')         GROUP BY WF_NAME,                  NVL (                     SUBSTR (                        FILENAME,                        DECODE (INSTR (FILENAME, '/') + 1,                                1, 99999,                                INSTR (FILENAME, '/') + 1),                        LENGTH (FILENAME)),                     '0'),                  TARGET_HOST,                  KAFKA_TOPIC,                  EVENT_DESCRIPTION         ORDER BY WF_NAME,                  STARTED,                  ENDED,                  RETRIES,                  TARGET_HOST,                  KAFKA_TOPIC,                  EVENT_DESCRIPTION)  WHERE RETRIES >= 3 AND event_description = 'ERRONEOUS'

--Kafka missing acknoledge
SELECT * FROM   (         SELECT WF_NAME, FILENAME_OUT, SUM(CDR_COUNT) AS RECORDS_DIST,                (                 SELECT SUM(EVENT_COUNT)                 FROM ( SELECT WF_NAME,                               FILENAME,                               EVENT_COUNT                        FROM   EVENT_DIST_AUDIT                        WHERE     (   WF_NAME LIKE 'CCMS%' OR WF_NAME LIKE 'RECO%')                             AND EVENT_DESCRIPTION = 'OUTBOUND'                               AND TRANSFER_TIMESTAMP >= SYSDATE - INTERVAL '750' MINUTE                               AND TRANSFER_TIMESTAMP <= SYSDATE                               AND NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0') = 0                      ) B                 WHERE  B.FILENAME = A.FILENAME_OUT                 GROUP BY WF_NAME, FILENAME                ) RECORDS_OUTBOUND         FROM  PROC_OUT_AUDIT A         WHERE     WF_NAME IN ( 'CONCENTRATED', 'DEACTIVATION', 'DEL_DEACTIVATION', 'RATE_PLAN_CHANGE', 'SMART_CAMP_REPORTS', 'SMART_CAMP_REWARDS',                                 'DATA_SUBSCRIPTION', 'DATA_TRAFFIC', 'OCS_CCN', 'POP_SMS_VOICE', 'NGIN_DATA_SUBSCRIPTION', 'NGIN_DATA_TRAFFIC' , 'RECO_Proc'                            )               AND TIMESTAMP >= SYSDATE - INTERVAL '750' MINUTE                             AND TIMESTAMP <= SYSDATE - INTERVAL '30' MINUTE         GROUP BY WF_NAME, FILENAME_OUT        ) WHERE  RECORDS_DIST != NVL(RECORDS_OUTBOUND,0)

--RESTART VASIS pote egine
SELECT STARTUP_TIME FROM dba_hist_database_instance ORDER BY startup_time DESC

--Active Sessions

select distinct machine, schemaname, osuser, program, username
from   v$session
where  username=''
and    machine like '%'

select * from dba_audit_trail
--SGSN Addresses 

SELECT * FROM system_log l
where 1=1
-- id > ((select max(id) FROM g)-500000)
and creation_time>=trunc(sysdate)
--and creation_time<trunc(sysdate-14)  
and message like '% %'
--and message like 'The IP Address []%'

select * from event_dist_audit where WF_NAME like '%DATA%'  order by 4 desc

select * from system_log where message like '%Result_Code = [%]%' 

select distinct(substr(message,instr(message,'Result_Code'),20)) Error, count(*) from  mzowner.system_log where message like '%Result_Code = [%]%' and creation_time >= sysdate -7 group by (substr(message,instr(message,'Result_Code'),20))

select distinct(substr(message,instr(message,'resultCode'),19)) Error, count(*) from  mzowner.system_log where message like '%resultCode = [%]%' and creation_time >= sysdate -1 group by (substr(message,instr(message,'resultCode'),19))

select distinct(substr(short_message,instr(short_message,'Result_Code'),19)) Error, count(*) from  mzowner.system_log where message like '%Result_Code%[%]%' and creation_time >= sysdate -7 group by (substr(short_message,instr(short_message,'Result_Code'),19))

select *
from .system_log
where wf_instance_name=''
and creation_time>=trunc(sysdate)-3
and substr(substr(short_message,instr(short_message,'resultCode')),15,4)!='5030'
and substr(substr(short_message,instr(short_message,'resultCode')),15,4)!='5012'
and substr(substr(short_message,instr(short_message,'resultCode')),36,4)='2001'


SELECT count(*) FROM mzowner.system_log l
where id > ((select max(id) FROM mzowner.system_log)-500000)
and creation_time>=trunc(sysdate-1)
and message like '% SGSN_ADDRESSES lookup table%'
and message not like 'The IP Address [10.24.15.49]%'
and message not like 'The IP Address [10.20.114.177]%'
and message not like 'The IP Address [10.22.28.49]%'

and message not like 'The IP Address [10.35.48.744]%'


select count(*) from ( SELECT * FROM mzowner.system_log WHERE creation_time > sysdate - interval '30' minute   AND MESSAGE LIKE '%Error in Diameter - Result_Code = [5012] ErrorMessage%')

select count(*) from ( SELECT * FROM mzowner.system_log WHERE creation_time > sysdate - interval '30' minute   AND MESSAGE LIKE '%Error in Diameter - Result_Code = [5012] ErrorMessage%')

select count(*) from ( SELECT * FROM mzowner.system_log WHERE creation_time > sysdate - 2   AND MESSAGE LIKE '%resultCode = [5012]%')

select distinct (substr(message,instr(message,'3069'),12)) msisdn, count(*) from mzowner.system_log  where message like '%resultCode = [4012]%'  and creation_time >= sysdate -60/1440  and LENGTH(TRIM(TRANSLATE((substr(message,instr(message,'3069'),12)), ' +-.0123456789', ' '))) is null group by (substr(message,instr(message,'3069'),12))

select distinct (substr(message,instr(message,'3069'),12)) msisdn, count(*) from mzowner.system_log  where message like '%resultCode = [4012]%'  and creation_time >= sysdate -3  and LENGTH(TRIM(TRANSLATE((substr(message,instr(message,'3069'),12)), ' +-.0123456789', ' '))) is null group by (substr(message,instr(message,'3069'),12))

select distinct (substr(message,instr(message,'3069'),12)) msisdn, count(*) from mzowner.system_log  where message like '%resultCode = [5012]%'  and creation_time >= sysdate -120/1440  and LENGTH(TRIM(TRANSLATE((substr(message,instr(message,'3069'),12)), ' +-.0123456789', ' '))) is null group by (substr(message,instr(message,'3069'),12))

select distinct (substr(message,instr(message,'3069'),12)) msisdn, count(*) from mzowner.system_log  where message like '%resultCode = [5012]%'  and creation_time >= sysdate -1  and LENGTH(TRIM(TRANSLATE((substr(message,instr(message,'3069'),12)), ' +-.0123456789', ' '))) is null group by (substr(message,instr(message,'3069'),12))

select count(*) from ( SELECT * FROM mzowner.system_log WHERE creation_time > sysdate - 1   AND MESSAGE LIKE '%resultCode = [5030]%')

select distinct (substr(message,instr(message,'3069'),12)) msisdn, count(*) from mzowner.system_log  where message like '%resultCode = [5030]%'  and creation_time >= sysdate -1  and LENGTH(TRIM(TRANSLATE((substr(message,instr(message,'3069'),12)), ' +-.0123456789', ' '))) is null group by (substr(message,instr(message,'3069'),12)) order by 2 desc

select distinct (substr(message,instr(message,'3069'),12)) msisdn, count(*) from mzowner.system_log  where message like '%resultCode = [5030]%'  and creation_time >= sysdate -360/1440  and LENGTH(TRIM(TRANSLATE((substr(message,instr(message,'3069'),12)), ' +-.0123456789', ' '))) is null group by (substr(message,instr(message,'3069'),12))  having count(*) < 9 order by 2 desc

select * from Dist_audit where WF_NAME like '%Diameter%' order by 4 desc

SELECT TO_DATE('22/APR/2021') FROM dual


select * from coll_audit where WF_NAME like '%%' and filename_out like '%-154300%'
 order by 6 desc

select * from coll_audit where WF_NAME like '%%' and filename_out like '%%'  order by 6 desc

select * from coll_audit where WF_NAME like '%%' --
--and filename_in like '%Email%'
 order by 6 desc

select * from dist_audit where WF_NAME like '%%' 
--and filename_in like '%%'
 order by 6 desc

select * from dist_audit where WF_NAME like '%%'  and filename_out like '%%'
--and timestamp_in like sysdate  
 order by 6 desc


select * from coll_audit where WF_NAME like '%PRP_LOGICA%' --order by 6 desc 
and filename_in in ('Cosmote_OK_ARCHIVE2020-08-05.18:10:35.27073',
'Cosmote_OK_ARCHIVE2020-08-05.18:10:43.27076',
'Cosmote_OK_ARCHIVE2020-08-05.18:11:08.27075')  order by 6 desc

--count by sysdate
select WF_NAME ,TO_CHAR(SYSDATE, 'YYYY-MM-DD'),count(*) from coll_audit  where WF_NAME like '%CNTN%'    group by WF_NAME  order by 2 desc



--DIameter Reprocess
SELECT WF_NAME,
       FILTER_CODE,
       FILTER_DATE,
       SUM(CDR_COUNT) TOTAL_CDRS,
       MIN(TIMESTAMP) MIN_TIMESTAMP,
       MAX(TIMESTAMP) MAX_TIMESTAMP
FROM (
      SELECT WF_NAME, 
             DECODE
               (FILTER_CODE,
                68, '' ) FILTER_CODE,
             TRUNC(TIMESTAMP) FILTER_DATE,
             TIMESTAMP,
             CDR_COUNT
      FROM PROC_FLT_AUDIT P
      WHERE P.WF_NAME LIKE '%Diameter%'
      AND TIMESTAMP >= TRUNC(SYSDATE)
     )
GROUP BY WF_NAME,
         FILTER_CODE,
         FILTER_DATE
         HAVING FILTER_CODE IS NOT NULL
ORDER BY FILTER_DATE,
         FILTER_CODE;

select * from dist_audit where filename_in like '%NTASRENTIS1B.8390%' order by 6 desc

--Diameter reproc last 30 mins
SELECT *
FROM PROC_FLT_AUDIT P
WHERE P.WF_NAME LIKE '%%'
AND TIMESTAMP >= sysdate-1
AND filter_code = 68
AND filter_code is not null

--Diameter reproc ana ora
SELECT
    DECODE
    (FILTER_CODE,
        66, 'DIAMETER_COMPLETED',
        68, 'DIAMETER_REPROCESS') FILTER_CODE,
to_char(timestamp,'HH24'),sum(cdr_count)
FROM PROC_FLT_AUDIT P
WHERE P.WF_NAME LIKE '%Diameter%'
AND TIMESTAMP >=trunc(sysdate)
AND filter_code IN (68)
group by filter_code,to_char(timestamp,'HH24')
order by 2

select * from proc_in_audit where 
WF_NAME   like '%%'
 filename like '%vot_2020-11-09%'
 order by 4 desc

select * from dist_audit where WF_NAME like '%WLR%'
 order by 6 desc 
--and Filename_in like '%AMPELOKIPI04A.2694%'  order by 6 desc--and filesize not like '0'  

select * from dist_audit where WF_NAME like '%%' 
  and Filename_in like '%vot_2020-11-09%' and filesize not like '0' order by 6 desc

select  trunc(TIMESTAMP_IN),count(filename_out) from dist_audit where filename_out like '%25CCN14%' and filesize not like 0  group by trunc(TIMESTAMP_IN) order by 1 desc

--EVENT DIST AUDIT COUNT
select TO_CHAR(TRANSFER_TIMESTAMP,'YYYY-MM-DD'),event_description,
wf_name,
sum(event_count) from event_dist_audit 
where wf_name like '%EBR_%'
-- in ('JRNY_CROSS_REF_MAP_Audit','CONSENT_Audit','SGK_UCM_CLI_Audit','SGK_UCM_MSISDN_Audit')
and EVENT_DESCRIPTION like '%%'
group by TO_CHAR(TRANSFER_TIMESTAMP,'YYYY-MM-DD') ,event_description 
,wf_name
order by 1 desc


select * from coll_audit where WF_NAME like '%%' and filename_in like '%%' order by 6 desc

select * from proc_in_audit where 
--wf_name  like '%%' and 
filename like '%IMS_%:1_IMS_20200616204203_SEQ91684:20200616204203582103%' 
order by 4 desc

select * from proc_out_audit where 
wf_name  = 'SMSoIP_Proc' and
 filename_in like '%IPSMGW_Greece1_1_202008181154_90311-2020_08_18_12_02_08_391.asn1%'

select * from TIME_GAP_ZONES where WF_instance like '%OCSCCN_BSCS_SDP%'

select * from TIME_GAP where WF_instance like '%OCSCCN_BSCS_SDP%'


Insert into COS_OPER_OWNER.TIME_GAP
   (WF_INSTANCE, TIMESTAMP, DIRECTION, ALARM)
Values
   ('MTB_MOB_RP_FEES', TO_DATE('10/09/2020 07:05:14', 'MM/DD/YYYY HH24:MI:SS'), 0, 0)
   
   Insert into COS_OPER_OWNER.TIME_GAP
   (WF_INSTANCE, TIMESTAMP, DIRECTION, ALARM)
Values
   ('IMS_RAFO', TO_DATE('03/23/2020 09:02:14', 'MM/DD/YYYY HH24:MI:SS'), 1, 0);
  
 Insert into COS_OPER_OWNER.TIME_GAP
   (WF_INSTANCE, TIMESTAMP, DIRECTION, ALARM)
Values
   ('VoiceRetailIMS_RA', TO_DATE('03/23/2020 09:02:14', 'MM/DD/YYYY HH24:MI:SS'), 1, 0);

commit;


Insert into COS_OPER_OWNER.TIME_GAP_ZONES
   (WF_INSTANCE, GAP, STARTTIME, ENDTIME)
Values
   ('MTB_MOB_RP_FEES', 1800, '00:00', '23:59') 
   
 Insert into COS_OPER_OWNER.TIME_GAP_ZONES
   (WF_INSTANCE, GAP, STARTTIME, ENDTIME)
Values
   ('VoiceRetailIMS_RA', 1200, '00:00', '08:59')   
   
  Insert into COS_OPER_OWNER.TIME_GAP_ZONES
   (WF_INSTANCE, GAP, STARTTIME, ENDTIME)
Values
   ('IMS_RAFO', 180, '00:00', '23:59')     
 --searching systemlog
select trunc(L.CREATION_TIME), count(*)  from mzowner.system_log l where L.MESSAGE like '%MSP%' and L.CREATION_TIME >= sysdate -30
group by trunc(L.CREATION_TIME) order by 1 desc

    

--corrupted files 
   select WF_INSTANCE_NAME,MESSAGE,CREATION_TIME   from mzowner.system_log l --where L.MESSAGE like '%SEQ%ECS%' 
   WHERE (   L.MESSAGE LIKE 'An error was encountered during file decoding%'
       OR L.MESSAGE LIKE 'An error occured during file decoding.%'
       OR L.MESSAGE LIKE 'Unexpected end of file.%'
      )
      and WF_INSTANCE_NAME != 'COS_BM_MSP.MSP_WF_Proc.MSP_Proc'
       and L.CREATION_TIME >= sysdate -60 
      |
      |
   order by 3 desc

SELECT count(filename) 
  FROM X
WHERE day BETWEEN TO_DATE ('05/07/2020 00:00:00', 'dd/mm/yyyy hh24:mi:ss')
               AND TO_DATE ('05/07/2020 23:59:59', 'dd/mm/yyyy hh24:mi:ss');


    SELECT pico_name,creation_time,message FROM mzowner.system_log 
WHERE message not like 'An error was encountered during file decoding%' 
and short_message not like 'Message from duplicate UDR node:'
and message not like '%Trailers in file%'
and message not like '%Headers in file%'


SELECT * FROM   (         SELECT WF_NAME, FILENAME_OUT, SUM(CDR_COUNT) AS RECORDS_DIST,                (                 SELECT SUM(EVENT_COUNT)                 FROM ( SELECT WF_NAME,                               FILENAME,                               EVENT_COUNT                        FROM   EVENT_DIST_AUDIT                        WHERE      WF_NAME LIKE 'CCMS%'                               AND EVENT_DESCRIPTION = 'OUTBOUND'                               AND TRANSFER_TIMESTAMP >= SYSDATE - INTERVAL '270' MINUTE                               AND TRANSFER_TIMESTAMP <= SYSDATE                               AND NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0') = 0                      ) B                 WHERE  B.FILENAME = A.FILENAME_OUT                 GROUP BY WF_NAME, FILENAME                ) RECORDS_OUTBOUND,                 (                 SELECT SUM(EVENT_COUNT)                 FROM ( SELECT WF_NAME,                               CASE WHEN                               SUBSTR(FILENAME, 0, INSTR(FILENAME, '/')-1) IS NOT NULL                               THEN SUBSTR(FILENAME, 0, INSTR(FILENAME, '/')-1)                               ELSE FILENAME                               END FILENAME,                               EVENT_COUNT                        FROM   EVENT_DIST_AUDIT                        WHERE      WF_NAME LIKE 'CCMS%'                               AND EVENT_DESCRIPTION = 'ACKNOWLEDGED'                               AND TRANSFER_TIMESTAMP >= SYSDATE - INTERVAL '270' MINUTE                               AND TRANSFER_TIMESTAMP <= SYSDATE                      ) B                 WHERE  B.FILENAME = A.FILENAME_OUT                 GROUP BY WF_NAME, FILENAME                ) RECORDS_ACKNOWLEDGED         FROM  PROC_OUT_AUDIT A         WHERE     WF_NAME IN ( 'CONCENTRATED', 'DEACTIVATION', 'DEL_DEACTIVATION', 'RATE_PLAN_CHANGE', 'SMART_CAMP_REPORTS',                                'SMART_CAMP_REWARDS', 'DATA_SUBSCRIPTION', 'DATA_TRAFFIC', 'OCS_CCN', 'POP_SMS_VOICE'                             )               AND TIMESTAMP >= SYSDATE - INTERVAL '270' MINUTE               AND TIMESTAMP <= SYSDATE - INTERVAL '30' MINUTE         GROUP BY WF_NAME, FILENAME_OUT        ) WHERE  RECORDS_OUTBOUND != NVL(RECORDS_ACKNOWLEDGED,0)

SELECT *
FROM   (
        SELECT WF_NAME, FILENAME_OUT, SUM(CDR_COUNT) AS RECORDS_DIST,
               (
                SELECT SUM(EVENT_COUNT)
                FROM ( SELECT WF_NAME,
                              FILENAME,
                              EVENT_COUNT
                       FROM   EVENT_DIST_AUDIT
                       WHERE      WF_NAME LIKE 'CCMS%'
                              AND EVENT_DESCRIPTION = 'OUTBOUND'
                              AND TRANSFER_TIMESTAMP >= SYSDATE - INTERVAL '270' MINUTE                          
                              AND TRANSFER_TIMESTAMP <= SYSDATE
                              AND NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0') = 0
                     ) B
                WHERE  B.FILENAME = A.FILENAME_OUT
                GROUP BY WF_NAME, FILENAME
               ) RECORDS_OUTBOUND,
                (
                SELECT SUM(EVENT_COUNT)
                FROM ( SELECT WF_NAME,
                              CASE WHEN
                              SUBSTR(FILENAME, 0, INSTR(FILENAME, '/')-1) IS NOT NULL
                              THEN SUBSTR(FILENAME, 0, INSTR(FILENAME, '/')-1)
                              ELSE FILENAME
                              END FILENAME,
                              EVENT_COUNT
                       FROM   EVENT_DIST_AUDIT
                       WHERE      WF_NAME LIKE 'CCMS%'
                              AND EVENT_DESCRIPTION = 'ACKNOWLEDGED'
                              AND TRANSFER_TIMESTAMP >= SYSDATE - INTERVAL '270' MINUTE                    
                              AND TRANSFER_TIMESTAMP <= SYSDATE
                     ) B
                WHERE B.FILENAME = A.FILENAME_OUT
                GROUP BY WF_NAME, FILENAME
               ) RECORDS_ACKNOWLEDGED
        FROM  PROC_OUT_AUDIT A
        WHERE     WF_NAME IN ( 'CONCENTRATED', 'DEACTIVATION', 'DEL_DEACTIVATION', 'RATE_PLAN_CHANGE', 'SMART_CAMP_REPORTS', 'SMART_CAMP_REWARDS', 
                               'DATA_SUBSCRIPTION', 'DATA_TRAFFIC', 'OCS_CCN', 'POP_SMS_VOICE', 'NGIN_DATA_SUBSCRIPTION', 'NGIN_DATA_TRAFFIC'
                            )
              AND TIMESTAMP >= SYSDATE - INTERVAL '270' MINUTE
              -- DEFINE TRANSFER TIMESTAMP RANGE. IT CAN BE ONE DAY OR MORE.
              AND TIMESTAMP <= SYSDATE - INTERVAL '30' MINUTE
        GROUP BY WF_NAME, FILENAME_OUT
       )
WHERE  RECORDS_OUTBOUND != NVL(RECORDS_ACKNOWLEDGED,0)

SELECT * FROM   (         SELECT WF_NAME, FILENAME_OUT, SUM(CDR_COUNT) AS RECORDS_DIST,                (                 SELECT SUM(EVENT_COUNT)                 FROM ( SELECT WF_NAME,                               FILENAME,                               EVENT_COUNT                        FROM   EVENT_DIST_AUDIT                        WHERE     (   WF_NAME LIKE 'CCMS%' OR WF_NAME LIKE 'RECO%')                             AND EVENT_DESCRIPTION = 'OUTBOUND'                               AND TRANSFER_TIMESTAMP >= SYSDATE - INTERVAL '750' MINUTE                               AND TRANSFER_TIMESTAMP <= SYSDATE                               AND NVL(SUBSTR(FILENAME, DECODE(INSTR(FILENAME, '/')+1, 1, 99999, INSTR(FILENAME, '/')+1), LENGTH(FILENAME)), '0') = 0                      ) B                 WHERE  B.FILENAME = A.FILENAME_OUT                 GROUP BY WF_NAME, FILENAME                ) RECORDS_OUTBOUND         FROM  PROC_OUT_AUDIT A         WHERE     WF_NAME IN ( 'CONCENTRATED', 'DEACTIVATION', 'DEL_DEACTIVATION', 'RATE_PLAN_CHANGE', 'SMART_CAMP_REPORTS', 'SMART_CAMP_REWARDS',                                 'DATA_SUBSCRIPTION', 'DATA_TRAFFIC', 'OCS_CCN', 'POP_SMS_VOICE', 'NGIN_DATA_SUBSCRIPTION', 'NGIN_DATA_TRAFFIC' , 'RECO_Proc'                            )               AND TIMESTAMP >= SYSDATE - INTERVAL '750' MINUTE                             AND TIMESTAMP <= SYSDATE - INTERVAL '30' MINUTE         GROUP BY WF_NAME, FILENAME_OUT        ) WHERE  RECORDS_DIST != NVL(RECORDS_OUTBOUND,0)



--MISSING FILES CHECK

select substr(filenamein,5,instr(filenamein,':')-5)||'.'||substr(filenamein,instr(filenamein,':')+3,4) filename,timestampin,cdrin,cdrhdr,cdrfo,cdrin-cdrhdr-cdrfo from (
select inputfile.filenamein,inputfile.timestampin,inputfile.cdrin,hdrfile.cdrhdr  from
(
select substr(filename,1,instr(filename,':',1,2)-1) filenamein, trunc(timestamp) timestampin,cdr_count cdrin
from PROC_IN_AUDIT pin
where agent_name='fromPreProc' and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 10
) inputfile join (
select substr(filename,1,instr(filename,':',1,2)-1) filenamehdr , trunc(timestamp)  timestamphdr,cdr_count cdrhdr ,  hdr.* from PROC_FLT_AUDIT hdr
where filter_code=5 and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 10
)hdrfile  on inputfile.filenamein=hdrfile.filenamehdr and inputfile.timestampin=hdrfile.timestamphdr ) c join  (
select substr(filename_out,1,instr(filename_out,':',1,2)-1) filenameout,trunc(timestamp) timestampout,cdr_count cdrfo -- pout.*
from PROC_OUT_AUDIT pout
where agent_name = 'Proc4_RAFO_Disk' and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 10
) fofile on c.filenamein=fofile.filenameout and c.timestampin=fofile.timestampout
and substr(filenamein,5,instr(filenamein,':')-5)||'.'||substr(filenamein,instr(filenamein,':')+3,4) in (
'ERMOY2A.1324')
order by 1 desc


select * from dba_users  where ACCOUNT_STATUS like '%%' order by 6 desc



--Create/Drop table
Drop table Session_Watcher

Create Table Session_Watcher as 
select username , schemaname , osuser ,machine , program ,sysdate as DTM from v$session where rownum <2 

truncate table Session_Watcher

select * from Session_Watcher

select * from dba_audit_trail


select substr(filenamein,5,instr(filenamein,':')-5)||'.'||substr(filenamein,instr(filenamein,':')+3,4)
filename,timestampin,cdrin,cdrhdr,cdrfo,cdrin-cdrhdr-cdrfo from (
select inputfile.filenamein,inputfile.timestampin,inputfile.cdrin,hdrfile.cdrhdr from
(
select substr(filename,1,instr(filename,':',1,2)-1) filenamein, trunc(timestamp)
timestampin,cdr_count cdrin
from PROC_IN_AUDIT pin
where agent_name='fromPreProc' and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 20 and timestamp <=sysdate - 1
) inputfile join (
select substr(filename,1,instr(filename,':',1,2)-1) filenamehdr , trunc(timestamp) 
timestamphdr,cdr_count cdrhdr , hdr.* from PROC_FLT_AUDIT hdr
where filter_code=5 and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 20 and timestamp <=sysdate - 1
)hdrfile on inputfile.filenamein=hdrfile.filenamehdr and
inputfile.timestampin=hdrfile.timestamphdr ) c join (
select substr(filename_out,1,instr(filename_out,':',1,2)-1) filenameout,trunc(timestamp)
timestampout,cdr_count cdrfo -- pout.*
from PROC_OUT_AUDIT pout
where agent_name = 'Proc4_RAFO_Disk' and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 20 and timestamp <=sysdate - 1
) fofile on c.filenamein=fofile.filenameout and c.timestampin=fofile.timestampout
and substr(filenamein,5,instr(filenamein,':')-5)||'.'||substr(filenamein,instr(filenamein,':')+3,4)
in ('NAMPE01A.0378')

select distinct (substr(message,instr(message,'3069'),12)) msisdn, 
count(*) from mzowner.system_log  where message like '%resultCode = [5012]%'  
and creation_time >= sysdate -1  and LENGTH(TRIM(TRANSLATE((substr(message,instr(message,'3069'),12)), 
' +-.0123456789', ' '))) is null group by (substr(message,instr(message,'3069'),12))


select substr(filenamein,5,instr(filenamein,':')-5)||'.'||substr(filenamein,instr(filenamein,':')+3,4) filename,timestampin,cdrin,cdrhdr,cdrfo,cdrin-cdrfo from (
select inputfile.filenamein,inputfile.timestampin,inputfile.cdrin,hdrfile.cdrhdr from
(
select substr(filename,1,instr(filename,':',1,2)-1) filenamein, trunc(timestamp) timestampin,cdr_count cdrin
from PROC_IN_AUDIT pin
where agent_name='fromPreProc' and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 27 and timestamp <=sysdate - 23
) inputfile left join (
select substr(filename,1,instr(filename,':',1,2)-1) filenamehdr , trunc(timestamp) timestamphdr,cdr_count cdrhdr , hdr.* from PROC_FLT_AUDIT hdr
where filter_code=5 and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 27 and timestamp <=sysdate - 23 
)hdrfile on inputfile.filenamein=hdrfile.filenamehdr and inputfile.timestampin=hdrfile.timestamphdr ) c join (
select substr(filename_out,1,instr(filename_out,':',1,2)-1) filenameout,trunc(timestamp) timestampout,cdr_count cdrfo -- pout.*
from PROC_OUT_AUDIT pout
where agent_name = 'Proc4_RAFO_Disk' and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 27 and timestamp <=sysdate - 23
) fofile on c.filenamein=fofile.filenameout and c.timestampin=fofile.timestampout
and substr(filenamein,5,instr(filenamein,':')-5)||'.'||substr(filenamein,instr(filenamein,':')+3,4) in 
('NAMPE01A.0001','NAMPE01A.0002','NAMPE01A.0003','NAMPE01A.0004','NAMPE01A.0005','NAMPE01A.0006','NAMPE01A.0007','NAMPE01A.0008','NAMPE01A.0009','NAMPE01A.0010','NAMPE01A.0011','NAMPE01A.0012','NAMPE01A.0013','NAMPE01A.0014')
order by 1 desc


//////////////////######################

select substr(filenamein,5,instr(filenamein,':')-5)||'.'||substr(filenamein,instr(filenamein,':')+3,4)
filename,timestampin,cdrin,cdrhdr,cdrfo,cdrin-cdrfo from (
select inputfile.filenamein,inputfile.timestampin,inputfile.cdrin,hdrfile.cdrhdr from
(
select substr
(filename,1,instr(filename,':',1,2)-1) filenamein, trunc(timestamp) timestampin,cdr_count cdrin
from PROC_IN_AUDIT pin
where agent_name='fromPreProc' and substr(wf_name,1,9) ='MSC_Proc1'
abd timestamp >=sysdate - 27 and timestamp <=sysdate - 23
) inputfile left join (
select substr(filename,1,instr(filename,':',1,2)-1) filenamehdr and inputfile.timestamp=hdr
)


select substr(filenamein,5,instr(filenamein,':')-5)||'.'||substr(filenamein,instr(filenamein,':')+3,4) filename,timestampin,cdrin,cdrhdr,cdrfo,cdrin-cdrfo from (
select inputfile.filenamein,inputfile.timestampin,inputfile.cdrin,hdrfile.cdrhdr from
(
select substr(filename,1,instr(filename,':',1,2)-1) filenamein, trunc(timestamp) timestampin,cdr_count cdrin
from PROC_IN_AUDIT pin
where agent_name='fromPreProc' and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 10 and timestamp <=sysdate - 1
) inputfile left join (
select substr(filename,1,instr(filename,':',1,2)-1) filenamehdr , trunc(timestamp) timestamphdr,cdr_count cdrhdr , hdr.* from PROC_FLT_AUDIT hdr
where filter_code=5 and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 10 and timestamp <=sysdate - 1
)hdrfile on inputfile.filenamein=hdrfile.filenamehdr and inputfile.timestampin=hdrfile.timestamphdr ) c join (
select substr(filename_out,1,instr(filename_out,':',1,2)-1) filenameout,trunc(timestamp) timestampout,cdr_count cdrfo -- pout.*
from PROC_OUT_AUDIT pout
where agent_name = 'Proc4_RAFO_Disk' and substr(wf_name,1,9) ='MSC_Proc1'
and timestamp >=sysdate - 10 and timestamp <=sysdate - 1
) fofile on c.filenamein=fofile.filenameout and c.timestampin=fofile.timestampout
and substr(filenamein,5,instr(filenamein,':')-5)||'.'||substr(filenamein,instr(filenamein,':')+3,4) in (
'NAMPE01A.8550'
order by 1 desc


///////////////\\\\\\\\\\\\\\\\\

public class Narf {
public static void zoop(String fred, int bob) {
System.out.println(fred);
if (bob == 5) {
ping("not ");
} else {
System.out.println("!");
}
}
public static void main(String[] args) {
int bizz = 5;
int buzz = 2;
zoop("just for", bizz);
clink(2*buzz);
}
public static void clink(int fork) {
System.out.print("It's ");
zoop("breakfast ", fork) ;
}
public static void ping(String strangStrung) {
System.out.println("any " + strangStrung + "more ");
}
}
